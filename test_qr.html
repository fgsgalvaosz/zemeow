<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste QR Code</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .qr-image {
            max-width: 300px;
            height: auto;
            border: 2px solid #25D366;
            border-radius: 10px;
            padding: 10px;
            background: white;
            display: block;
            margin: 20px auto;
        }
        .test-result {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        button {
            background: #25D366;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #128C7E; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Teste de Renderiza√ß√£o QR Code</h1>
        
        <h2>1. Teste com QR Code da API</h2>
        <button onclick="testAPIQRCode()">Testar QR Code da API</button>
        <div id="apiResult"></div>
        <div id="apiQRContainer"></div>
        
        <h2>2. Teste com QR Code Base64 Simples</h2>
        <button onclick="testBase64QRCode()">Testar QR Code Base64</button>
        <div id="base64Result"></div>
        <div id="base64QRContainer"></div>
        
        <h2>3. Teste de Processamento</h2>
        <button onclick="testProcessing()">Testar Processamento</button>
        <div id="processingResult"></div>
    </div>

    <script>
        // Fun√ß√£o de processamento QR Code (copiada do Web Manager)
        function processQRCode(qrCode) {
            if (!qrCode) {
                console.error('QR Code is null or undefined');
                return null;
            }

            console.log('Received QR Code:', qrCode.substring(0, 100) + '...');

            if (qrCode.startsWith('data:image/')) {
                console.log('QR Code is already a data URL');
                return qrCode;
            }

            if (qrCode.match(/^[A-Za-z0-9+/=]+$/)) {
                console.log('QR Code is base64, adding data URL prefix');
                return `data:image/png;base64,${qrCode}`;
            }

            if (qrCode.startsWith('http://') || qrCode.startsWith('https://')) {
                console.log('QR Code is a URL');
                return qrCode;
            }

            console.error('Unknown QR Code format:', qrCode.substring(0, 50));
            return null;
        }

        async function testAPIQRCode() {
            const resultDiv = document.getElementById('apiResult');
            const containerDiv = document.getElementById('apiQRContainer');
            
            try {
                resultDiv.innerHTML = '<div class="test-result">üîÑ Buscando QR Code da API...</div>';
                
                const response = await fetch('/sessions/181ad105-d226-4ca1-9c97-562d8c05459c/qr', {
                    headers: {
                        'X-API-Key': 'test123'
                    }
                });
                
                const data = await response.json();
                
                if (data.success && data.data && data.data.qr_code) {
                    const qrCode = data.data.qr_code;
                    const processedQR = processQRCode(qrCode);
                    
                    resultDiv.innerHTML = `
                        <div class="test-result success">‚úÖ QR Code obtido com sucesso!</div>
                        <div class="test-result">üìè Tamanho: ${qrCode.length} caracteres</div>
                        <div class="test-result">üîç Formato: ${qrCode.substring(0, 50)}...</div>
                    `;
                    
                    containerDiv.innerHTML = `
                        <h3>QR Code da API:</h3>
                        <img src="${processedQR}" alt="QR Code da API" class="qr-image" 
                             onload="console.log('‚úÖ Imagem carregada com sucesso')" 
                             onerror="console.error('‚ùå Erro ao carregar imagem')" />
                    `;
                } else {
                    throw new Error('QR Code n√£o encontrado na resposta');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">‚ùå Erro: ${error.message}</div>`;
                containerDiv.innerHTML = '';
            }
        }

        function testBase64QRCode() {
            const resultDiv = document.getElementById('base64Result');
            const containerDiv = document.getElementById('base64QRContainer');
            
            // QR Code de teste (Hello World)
            const testQR = 'iVBORw0KGgoAAAANSUhEUgAAASwAAAEsAQMAAABDsxw2AAAABlBMVEX///8AAABVwtN+AAAFBUlEQVR4nOyaQY6rPBCEC3nhZd8AXwTF18oiEkhZcC0iLmJu4CUL5PpVJpN57z/AmJGeFyMl+UbCpt1d1Tb+jX/jN49IEoivYja5ErLxuQTaPnJL9CRTO2wADJ4LDONxCzkDcSP8k0z0E7pfgAUa/NFtGSNfW7Yd6IQtCPQzX62xu3uRtg83GO4PBP0UN9oVMLhXgc1rgZETAo1c+pB/CQaYn49OxHELWv+jD9jHNQX8HUg/jmkD+nl9bTnfh1tvNj/XLeX9MfTB/t6nP47VcY+awTSgN/jnmpD3hyvg/7LXRbGhUw6ISw94ciPJNQXyeYSU93tTzG3MniuVFhy3jPMXf7gtYb/Hd/Q2wdAH43zcoOiN+p+pAg8AtuM3YENH7P6os1tZkO8Px5T5PDoad8SGWGRNsaXLudYsPfbGzMMxgTy6htgAZD8v0AMrfXHm0SP7YwjJ8ImQK2O1CExR6++5dLT9UYvaEfUu9siG2NAlcFfZfcMY1wTzhyuA5oZ2mNZVOaBYRiyBuLu1BGBcWcP6HSGXxkLKuCuz2eRezFXPJPOSBNjvQ2yJ9eB+Kq6ZS689h0DsbukS4ZeuIRbJ7HdHZs5ksjweimhOsYCc13eIXBlT+hedzFQdDPdxLcKGkFQjWmJDf8qV3kxPbTbBpZD9BGgzfnLvhTHHxN0vHbPN+gt/aP3xGAL/8DJtsI3agEVEfG2Zk2MB9nMin7LbBNMGJNfSI98dKXuiCIGUat5H6ZirY5JXnuvSG5U3yElBnmtpY43+hliRZVniGRsJRvms7J/ciG9J0ASLqrRQ5bcpKhOMPKRgjljF9vBe3ktjMi5cWYyT07vgJACStYqWpSEmse3l/lCTgz5IceEBBINf/tDkP47FFMzvQG9WC64sdoI8V4K8N38BthF+Pm7yC2vRtGVjgdNi+/XVEHOqsXvUCyBr50dGO8MtMof8mkIbTEKFfG3M41KXd3pn25Dop6H7BdiWjBMisyZZDPdaEfxUN+A+xIYY+gCvKaj4LoBkbSA4ISTs/qPLWmDDKbZZG2sKE0mCkCnRIvdSro/FLeXdL7WvciquZ+2m1uaVn+InOTTA5PL9JMVFPbYp96Zgqgs0/zECTTDHJMWEkPPptia5bvMyAraPy+362NlNjeeEbkDdjLT9ccqd9VvV/DwGBOyS2TL+LJb9UU9S6qkV5+Nrn7bAXILqwkszWbpi+f5QasVjUAzXsnp1DKiWRT5rGhTktWdkcJQKn1xBO8wlmN8H1J5qOTNXAWtyAOdPkF8YU/moQAYGSEW4BQH+HUHuu7P989igyv9pp+tdyNna2U4nP7q3BVY7P+TSEeOB3vL4XPA+36H/ki6XxrTyfpeLwdnH4JNMmYcrfy1IE0yqZhpugcpsvQG1X/XlAb+VQwNMAatY7TJGqcF8x6CvHjEFOYRPv/e6WCz6dJ4AHreOuNcuNtxxHlJ/BVITjMn2agfyfYhyMk+q7I5H//cGbIBpqC4k2Lyq+HrJbMO41OsUfF0fq/dqPLll41p6s5kS21WKmZ//yG8/j9WbCRK0mafP8odLgeeRkAoGGmJaxbGKvnGppeC5yhQ8T4v9XT6ujUm3brXgBr5THtzSw6rebYthXCJzhnuVemEGqBswgJ/E1QYDtLwFsAmqC+MxhNr/YTJ8X664MFbv1Uy4hXouIGyqX3Et8t7xz+s3P439G//G1cZ/AQAA//+aipow78RAEQAAAABJRU5ErkJggg==';
            
            const processedQR = processQRCode(testQR);
            
            resultDiv.innerHTML = `
                <div class="test-result success">‚úÖ QR Code de teste processado!</div>
                <div class="test-result">üìè Tamanho: ${testQR.length} caracteres</div>
                <div class="test-result">üîç Processado: ${processedQR ? 'Sim' : 'N√£o'}</div>
            `;
            
            containerDiv.innerHTML = `
                <h3>QR Code Base64 de Teste:</h3>
                <img src="${processedQR}" alt="QR Code de Teste" class="qr-image" 
                     onload="console.log('‚úÖ Imagem de teste carregada')" 
                     onerror="console.error('‚ùå Erro ao carregar imagem de teste')" />
            `;
        }

        function testProcessing() {
            const resultDiv = document.getElementById('processingResult');
            
            const tests = [
                { input: 'data:image/png;base64,iVBORw0...', expected: 'data URL' },
                { input: 'iVBORw0KGgoAAAANSUhEUgAA...', expected: 'base64' },
                { input: 'https://example.com/qr.png', expected: 'URL' },
                { input: null, expected: 'null' },
                { input: '', expected: 'empty' }
            ];
            
            let results = '<h3>Resultados dos Testes:</h3>';
            
            tests.forEach((test, index) => {
                const result = processQRCode(test.input);
                const success = (test.expected === 'null' && result === null) || 
                               (test.expected === 'empty' && result === null) ||
                               (test.expected === 'data URL' && result === test.input) ||
                               (test.expected === 'base64' && result && result.startsWith('data:image/png;base64,')) ||
                               (test.expected === 'URL' && result === test.input);
                
                results += `
                    <div class="test-result ${success ? 'success' : 'error'}">
                        ${success ? '‚úÖ' : '‚ùå'} Teste ${index + 1}: ${test.expected} - ${success ? 'PASSOU' : 'FALHOU'}
                    </div>
                `;
            });
            
            resultDiv.innerHTML = results;
        }
    </script>
</body>
</html>
